# Blacklist

Blacklist – це перший підсервіс фільтрації по Health Factor (HF), MinBorrow та MinCollateral у системі LiqRegistry. Основна задача цього сервісу – відфільтрувати користувачів, які мають значення HF, MinBorrow та MinCollateral, що занадто відрізняються від потенційно цікавих для ліквідації, та додати їх до чорного списку (Blacklist).

> **Примітка:** сервіс є важливим. Але liqRegistry може працювати і без нього. В такому разі просто збільшиться кількість юзерів на Subgraph. Проте для оптимальної швидкості роботи в продакшені, наполегливо раджу запускати і блекліст.

## Основні принципи роботи Blacklist

### 1. Ініціалізація:

- Коли Blacklist запускається, вже має бути база користувачів, зібрана підсервісом Archive. Це забезпечує наявність даних для подальшої фільтрації. Проте не обов'язково чекати, поки база користувачів наповниться повністю. У наступному циклі, коли кількість користувачів збільшиться, Blacklist оновить свій список користувачів.

### 2. Фільтрація користувачів:

- Сервіс Blacklist бере всіх користувачів з бази Archive і перевіряє їхні дані:
  - Health Factor (HF): Якщо HF користувача занадто великий (наприклад, більше 10) або занадто малий, він додається до чорного списку.
  - Мінімальний об'єм кредиту (MinBorrow): Якщо Borrow занадто малий, користувач додається до чорного списку.
  - Мінімальна застава (MinCollateral): Якщо Collateral занадто малий, користувач додається до чорного списку.
- Наприклад, якщо у користувача HF більше 10, це означає, що умови для ліквідації цього користувача навряд чи будуть досягнуті в найближчий час, і тому немає сенсу моніторити його більш фокусованими сервісами (Subgraph).

### 3. Сканування по колу:

- Blacklist працює в режимі сканування по колу (також в такому режимі працює зв'язка Proxy + Subgraph), тобто сервіс безперервно сканує і перевіряє користувачів. Після повного циклу сканування, Blacklist проходить коло наново.

### 4. Додавання в Blacklist:

- Залежно від результатів перевірки, сервіс вирішує, чи додавати користувача до чорного списку чи ні. Задача Blacklist – мати список користувачів, з якими є сенс працювати, тобто тих, у кого відповідні параметри HF, MinBorrow та MinCollateral є "цікавими" для подальшого опрацювання.

### 5. Час сканування:

- Більшість наших сервісів використовують симулятор для отримання даних по користувачах. І станом на зараз всі сервіси використовують один інстанс симулятора. Оскільки наше завдання – отримувати максимально швидку відповідь від симулятора в інших сервісів, ми штучно уповільнюємо Blacklist (дивись параметр: "delayBetweenRequestsToSimulator": 5000 (мс)).
- Наразі Blacklist проходить коло сканування приблизно за півтори години на протоколі з найбільшою кількістю користувачів. Без штучного обмеження, сервіс може пройти сканування за 10 хвилин.

## Висновок

Blacklist забезпечує ефективне початкове відсівання користувачів, які не відповідають необхідним критеріям, що дозволяє зосередитися на тих, з ким є сенс працювати далі. Сервіс постійно підтримує актуальний список користувачів для подальшої обробки в системі LiqRegistry.

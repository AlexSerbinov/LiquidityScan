# Симулятор

## Опис

Симулятор - це утиліта, яка використовується в LiqRegistry для виконання двох основних функцій.

## Основні функції

### 1. Симуляція майбутніх транзакцій

- Використовується в TransmitFetcher для симуляції HealthFactor користувача в наступному блоці.
- Симуляція відбувається разом з транзакцією трансміту.

### 2. Отримання даних

- Виконує функції, подібні до методів GET в звичайній Ethereum-ноді.
- Використовується для отримання даних користувачів (наприклад, через getUserAccountData).
- Обрано замість ноди через високу швидкість, стабільність та здатність обробляти більший потік запитів.

## Сервіси, що використовують симулятор

- **Blacklist**: Отримання даних через getUserAccountData.
- **Subgraph**: Отримання даних через getUserAccountData.
- **DataFetcher**: Отримання даних через getUserAccountData.
- **TransmitFetcher**: Отримання даних та симуляція транзакцій.
- **Events**: Не використовує симулятор, використовує звичайну Ethereum-ноду.
- **Archive**: Не використовує симулятор, використовує звичайну Ethereum-ноду.

## Використання симулятора

- Службові класи для взаємодії знаходяться в папці `lib/simulator`.
- Кожен сервіс має параметри в Params:
  - **StateOverrides**: Байт-код смарт-контракту.
  - **FormatTrace**: Відповідає за повернення розширених логів (рекомендується встановлювати False для швидшої роботи).
  - **Адреса контракту**: Може бути будь-яка (використовується для симуляції).

## Додаткова інформація

- Деякі сервіси мають параметр "useSimulatorInsteadOfNode".
- Цей параметр дозволяє перемикатися між симулятором та нодою.
- Параметр доступний у Blacklist і DataFetcher, але відсутній у Subgraph.

## Приклад коду в params

```json
{
  "useSimulatorInsteadOfNode": true,
  "formattedTrace": false,
  "simulationContract": "0xF50024f746D94F144a79003D00000000e380A500",
  "stateOverrides": {
    "0xF50024f746D94F144a79003D00000000e380A500": {
      "code": "0x608080604052600436101561001357600080fd5b600324324u23i40x60808060405260043610156100135..." // big hex data
    }
  }
}
```
